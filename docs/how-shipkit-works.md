## How Shipkit works?

Want to find out how Shipkit works?
- see also [getting started guide](/docs/getting-started.md)
- or the entire [documentation index](/README.md#documentation)

### High level

Shipkit is a set of Gradle plugins.
Shipkit works out of the box with Java libraries or Gradle plugin projects hosted on GitHub.

Shipkit integrates with:
 - Travis CI (it's not difficult to use Shipkit with any CI)
 - Bintray (that's how we push to Maven Central)

If you already have release process you can still leverage a specific feature of Shipkit.
The best way to get started is to explain your use case to our team.
Reach out by [opening a ticket on GitHub](https://github.com/mockito/shipkit/issues/new)

### Details

How do we:
- [bump versions](/docs/features/version-bumps.md)
- [generate release notes](/docs/features/automated-release-notes.md)
- [publish binaries](/docs/features/publishing-binaries.md)
- [avoid unnecessary releases](/docs/gradle-plugins/release-needed-plugin.md)
- [automatically include contributors in pom.xml](/docs/features/celebrating-contributors.md)

Features we still work on:
- [automatically upgrade dependencies](/docs/gradle-plugins/upgrade-dependency-plugin.md)

### Sequence diagram

The following text image (created via https://textart.io/sequence[textart.io]) shows detailed sequence diagran.
```
+---------+                                 +---------+                                           +---------+                                                           +-----+                                                                +---------+ +---------+
| Travis  |                                 | Gradle  |                                           | Shipkit |                                                           | Git |                                                                | Bintray | | GitHub  |
+---------+                                 +---------+                                           +---------+                                                           +-----+                                                                +---------+ +---------+
     |                                           |                                                     |                                                                   |                                                                        |           |
     | Run gradlew build                         |                                                     |                                                                   |                                                                        |           |
     |------------------------------------------>|                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           | task createDependencyInfoFile                       |                                                                   |                                                                        |           |
     |                                           |---------------------------------------------------->|                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           | task generatePomFileForJavaLibraryPublication       |                                                                   |                                                                        |           |
     |                                           |---------------------------------------------------->|                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           | task publishJavaLibraryPublicationToMavenLocal      |                                                                   |                                                                        |           |
     |                                           |---------------------------------------------------->|                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                         Build successful  |                                                     |                                                                   |                                                                        |           |
     |<------------------------------------------|                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     | Run gradlew ciPerformRelease              |                                                     |                                                                   |                                                                        |           |
     |------------------------------------------>|                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           | Run all depended tasks                              |                                                                   |                                                                        |           |
     |                                           |-----------------------                              |                                                                   |                                                                        |           |
     |                                           |                      |                              |                                                                   |                                                                        |           |
     |                                           |<----------------------                              |                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           | task identifyGitBranch                              |                                                                   |                                                                        |           |
     |                                           |---------------------------------------------------->|                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     | read branch name                                                  |                                                                        |           |
     |                                           |                                                     |------------------------------------------------------------------>|                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     |                                               current branch name |                                                                        |           |
     |                                           |                                                     |<------------------------------------------------------------------|                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |<----------------------------------------------------|                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           | task downloadPreviousReleaseArtifacts               |                                                                   |                                                                        |           |
     |                                           |---------------------------------------------------->|                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     | Download previous sources jar                                     |                                                                        |           |
     |                                           |                                                     |------------------------------------------------------------------------------------------------------------------------------------------->|           |
     |                                           |                                                     |                                                                   |                            ------------------------------------------\ |           |
     |                                           |                                                     |                                                                   |                            | Gradle plugins will be published to     |-|           |
     |                                           |                                                     |                                                                   |                            | Gradle Plugin Portal instead of Bintray | |           |
     |                                           |                                                     |                                                                   |                            |-----------------------------------------| |           |
     |                                           |                                                     |                                                                   |                                                    downloaded artifact |           |
     |                                           |                                                     |<-------------------------------------------------------------------------------------------------------------------------------------------|           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |<----------------------------------------------------|                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           | task comparePublications                            |                                                                   |                                                                        |           |
     |                                           |---------------------------------------------------->|                                                                   |                                                                        |           |
     |                                           |                                                     | ----------------------------------------------\                   |                                                                        |           |
     |                                           |                                                     |-| - compare current dependencies with previous|                   |                                                                        |           |
     |                                           |                                                     | | - compare current source jars with previous |                   |                                                                        |           |
     |                                           |                                                     | | - store result into file                    |                   |                                                                        |           |
     |                                           |                                                     | |---------------------------------------------|                   |                                                                        |           |
     |                                           |<----------------------------------------------------|                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           | task releaseNeeded                                  |                                                                   |                                                                        |           |
     |                                           |---------------------------------------------------->|                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     | Check if env variable SKIP_RELEASE exist                          |                                                                        |           |
     |                                           |                                                     |-----------------------------------------                          |                                                                        |           |
     |                                           |                                                     |                                        |                          |                                                                        |           |
     |                                           |                                                     |<----------------------------------------                          |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     | Check commit message                                              |                                                                        |           |
     |                                           |                                                     |------------------------------------------------------------------>|                                                                        |           |
     |                                           |                                                     |                                                                   | -----------------------------------------------------------------\     |           |
     |                                           |                                                     |                                                                   |-| If PR merge commit message contains:                           |     |           |
     |                                           |                                                     |                                                                   | | - [ci skip-release] then skip release                          |     |           |
     |                                           |                                                     |                                                                   | | - [ci skip-compare-publications] then ignore comparison result |     |           |
     |                                           |                                                     |                                                                   | |----------------------------------------------------------------|     |           |
     |                                           |                                                     |<------------------------------------------------------------------|                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                         Check if build Pull Request |                                                                   |                                                                        |           |
     |<------------------------------------------------------------------------------------------------|                                                                   |                                                                        |           |
     | -------------------------------------\    |                                                     |                                                                   |                                                                        |           |
     |-| Actually it checks if env          |    |                                                     |                                                                   |                                                                        |           |
     | | variable TRAVIS_PULL_REQUEST exist |    |                                                     |                                                                   |                                                                        |           |
     | |------------------------------------|    |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |------------------------------------------------------------------------------------------------>|                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     | Check branch name                                                 |                                                                        |           |
     |                                           |                                                     |------------------------------------------------------------------>|                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     |                                                       Branch name |                                                                        |           |
     |                                           |                                                     |<------------------------------------------------------------------|                                                                        |           |
     |                                           |                                                     | ------------------------------------------------\                 |                                                                        |           |
     |                                           |                                                     |-| Check if branch name match releaseBranchRegex |                 |                                                                        |           |
     |                                           |                                                     | | (default: "master|release/.+")                |                 |                                                                        |           |
     |                                           |                                                     | ----------------------------------------------------\             |                                                                        |           |
     |                                           |                                                     |-| Check comparison results                          |             |                                                                        |           |
     |                                           |                                                     | | (if [ci skip-compare-publications] doesn't exist) |             |                                                                        |           |
     |                                           |                                                     | |---------------------------------------------------|             |                                                                        |           |
     |                                           |                       Info is release needed or not |                                                                   |                                                                        |           |
     |                                           |<----------------------------------------------------|                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           | task gitCheckout                                    |                                                                   |                                                                        |           |
     |                                           |---------------------------------------------------->|                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     | Checkout specific branch                                          |                                                                        |           |
     |                                           |                                                     |------------------------------------------------------------------>|                                                                        |           |
     |                                           |                                                     |                                                                   | ------------------------------------------------------------\          |           |
     |                                           |                                                     |                                                                   |-| CI server automatically checks out rev hash of the commit |          |           |
     |                                           |                                                     |                                                                   | | so all commits are lost.                                  |          |           |
     |                                           |                                                     |                                                                   | | Shipkit needs them for version bumps and release notes.   |          |           |
     |                                           |                                                     |                                                                   | | Execute e.g.: git checkout master                         |          |           |
     |                                           |<------------------------------------------------------------------------------------------------------------------------| |-----------------------------------------------------------|          |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           | task gitUnshallow                                   |                                                                   |                                                                        |           |
     |                                           |---------------------------------------------------->|                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     | Get sufficient amount of commits                                  |                                                                        |           |
     |                                           |                                                     |------------------------------------------------------------------>|                                                                        |           |
     |                                           |                                                     |                                                                   | ------------------------------------------------------------------\    |           |
     |                                           |                                                     |                                                                   |-| CI server performs the unshallow clone.                         |    |           |
     |                                           |                                                     |                                                                   | | We need a good number of commits to generate release notes for. |    |           |
     |                                           |                                                     |                                                                   | | Execute: git fetch --unshallow --tags                           |    |           |
     |                                           |                                                     |                                                                   | |-----------------------------------------------------------------|    |           |
     |                                           |<------------------------------------------------------------------------------------------------------------------------|                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           | task setGitUserEmail                                |                                                                   |                                                                        |           |
     |                                           |---------------------------------------------------->|                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     | Set locally Git user email                                        |                                                                        |           |
     |                                           |                                                     |------------------------------------------------------------------>|                                                                        |           |
     |                                           |                                                     |                                                                   | -----------------------------------------------------------------\     |           |
     |                                           |                                                     |                                                                   |-| Execute: git config --local user.email <shipkit.org@gmail.com> |     |           |
     |                                           |                                                     |                                                                   | |----------------------------------------------------------------|     |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |<------------------------------------------------------------------------------------------------------------------------|                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           | task setGitUserName                                 |                                                                   |                                                                        |           |
     |                                           |---------------------------------------------------->|                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     | Set locally Git user name                                         |                                                                        |           |
     |                                           |                                                     |------------------------------------------------------------------>|                                                                        |           |
     |                                           |                                                     |                                                                   | ----------------------------------------------------\                  |           |
     |                                           |                                                     |                                                                   |-| Execute: git config --local user.name shipkit-org |                  |           |
     |                                           |                                                     |                                                                   | |---------------------------------------------------|                  |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |<------------------------------------------------------------------------------------------------------------------------|                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           | task bumpVersionFile                                |                                                                   |                                                                        |           |
     |                                           |---------------------------------------------------->|                                                                   |                                                                        |           |
     |                                           |                                                     | --------------------------------------\                           |                                                                        |           |
     |                                           |                                                     |-| Update values in version.properties |                           |                                                                        |           |
     |                                           |                                                     | |-------------------------------------|                           |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |<----------------------------------------------------|                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           | task identifyGitBranch                              |                                                                   |                                                                        |           |
     |                                           |---------------------------------------------------->|                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     | Read branch name                                                  |                                                                        |           |
     |                                           |                                                     |------------------------------------------------------------------>|                                                                        |           |
     |                                           |                                                     |                                                                   | -------------------------------------------\                           |           |
     |                                           |                                                     |                                                                   |-| It's needed in some next tasks           |                           |           |
     |                                           |                                                     |                                                                   | | Execute: git rev-parse --abbrev-ref HEAD |                           |           |
     |                                           |                                                     |                                                                   | |------------------------------------------|                           |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |<------------------------------------------------------------------------------------------------------------------------|                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           | task fetchContributors                              |                                                                   |                                                                        |           |
     |                                           |---------------------------------------------------->|                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     | Fetching all GitHub contributors                                  |                                                                        |           |
     |                                           |                                                     |------------------------------------------------------------------------------------------------------------------------------------------------------->|
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |<-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           | task fetchReleaseNotes                              |                                                                   |                                                                        |           |
     |                                           |---------------------------------------------------->|                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     | Fetch data about changes from the last release                    |                                                                        |           |
     |                                           |                                                     |------------------------------------------------------------------>|                                                                        |           |
     |                                           |                                                     |                                                                   | ------------------------------------------------------\                |           |
     |                                           |                                                     |                                                                   |-| Execute: git log --pretty=%ad --date=iso v0.0.1 -n 1|                |           |
     |                                           |                                                     |                                                                   | | git fetch origin +refs/tags/v0.0.1:refs/tags/v0.0.1 |                |           |
     |                                           |                                                     |                                                                   | | git log v0.0.1..HEAD                                |                |           |
     |                                           |                                                     |                                                                   | |-----------------------------------------------------|                |           |
     |                                           |                                                     |<------------------------------------------------------------------|                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     | Get information about GitHub issues                               |                                                                        |           |
     |                                           |                                                     |------------------------------------------------------------------------------------------------------------------------------------------------------->|
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |<-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           | task updateReleaseNotes                             |                                                                   |                                                                        |           |
     |                                           |---------------------------------------------------->|                                                                   |                                                                        |           |
     |                                           |                                                     | -------------------------\                                        |                                                                        |           |
     |                                           |                                                     |-| Generate Release Notes |                                        |                                                                        |           |
     |                                           |                                                     | |------------------------|                                        |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |<----------------------------------------------------|                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           | task gitCommit                                      |                                                                   |                                                                        |           |
     |                                           |---------------------------------------------------->|                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     | Commit release notes and version.properties                       |                                                                        |           |
     |                                           |                                                     |------------------------------------------------------------------>|                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |<------------------------------------------------------------------------------------------------------------------------|                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           | task gitTag                                         |                                                                   |                                                                        |           |
     |                                           |---------------------------------------------------->|                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     | Create tag                                                        |                                                                        |           |
     |                                           |                                                     |------------------------------------------------------------------>|                                                                        |           |
     |                                           |                                                     |                                                                   | -----------------------------------------------------------------\     |           |
     |                                           |                                                     |                                                                   |-| Execute: git tag -a v0.0.2 -m Created new tag v0.0.2 [ci skip] |     |           |
     |                                           |                                                     |                                                                   | | [ci skip] for not triggering infinite build loop on CI         |     |           |
     |                                           |                                                     |                                                                   | |----------------------------------------------------------------|     |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |<------------------------------------------------------------------------------------------------------------------------|                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           | task gitPush                                        |                                                                   |                                                                        |           |
     |                                           |---------------------------------------------------->|                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     | Push commit and tag                                               |                                                                        |           |
     |                                           |                                                     |------------------------------------------------------------------>|                                                                        |           |
     |                                           |                                                     |                                                                   | ----------------------------------\                                    |           |
     |                                           |                                                     |                                                                   |-| GitHub write token is used here |                                    |           |
     |                                           |                                                     |                                                                   | |---------------------------------|                                    |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |<------------------------------------------------------------------------------------------------------------------------|                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           | task performGitPush                                 |                                                                   |                                                                        |           |
     |                                           |---------------------------------------------------->|                                                                   |                                                                        |           |
     |                                           |                                                     | ---------------------------------------------------------------\  |                                                                        |           |
     |                                           |                                                     |-| This task only aggregate gitCommit, gitTag and gitPush tasks |  |                                                                        |           |
     |                                           |                                                     | |--------------------------------------------------------------|  |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |<----------------------------------------------------|                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           | task bintrayUpload                                  |                                                                   |                                                                        |           |
     |                                           |---------------------------------------------------->|                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     | upload artifacts                                                  |                                                                        |           |
     |                                           |                                                     |------------------------------------------------------------------------------------------------------------------------------------------->|           |
     |                                           |                                                     |                                                                   |                                                                        |           |
     |                                           |                                                     |                                                                   |                          Release shipped! Thank you for using Shipkit! |           |
     |                                           |<-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|           |
     |                                           |                                                     |                                                                   |                                                                        |           |
```


Thank you for reading!
Questions or feedback?
Start discussion [by opening a ticket](https://github.com/mockito/shipkit/issues/new) in GitHub!
